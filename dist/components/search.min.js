 /*
 * # Semantic UI
 * https://github.com/Semantic-Org/Semantic-UI
 * http://beta.semantic-ui.com/
 *
 * Copyright 2014 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,s,r){"use strict";e.fn.search=function(s){var n,i=e(this),a=i.selector||"",o=(new Date).getTime(),c=[],l=arguments[0],u="string"==typeof l,d=[].slice.call(arguments,1);return e(this).each(function(){var p,f=e.extend(!0,{},e.fn.search.settings,s),m=f.className,h=f.selector,g=f.error,v=f.namespace,y="."+v,b=v+"-module",w=e(this),x=w.find(h.prompt),C=w.find(h.searchButton),A=w.find(h.results),R=(w.find(h.result),w.find(h.category),this),T=w.data(b);p={initialize:function(){p.verbose("Initializing module");var e=x[0],t=e!==r&&e.oninput!==r?"input":e!==r&&e.onpropertychange!==r?"propertychange":"keyup";f.automatic&&x.on(t+y,p.search.throttle),x.on("focus"+y,p.event.focus).on("blur"+y,p.event.blur).on("keydown"+y,p.handleKeyboard),C.on("click"+y,p.search.query),A.on("mousedown"+y,p.event.mousedown).on("mouseup"+y,p.event.mouseup).on("click"+y,h.result,p.results.select),p.instantiate()},instantiate:function(){p.verbose("Storing instance of module",p),T=p,w.data(b,p)},destroy:function(){p.verbose("Destroying instance"),w.removeData(b),x.off(y),C.off(y),A.off(y)},event:{focus:function(){w.addClass(m.focus),clearTimeout(p.timer),p.search.throttle(),p.has.minimum()&&p.results.show()},mousedown:function(){p.resultsClicked=!0},mouseup:function(){p.resultsClicked=!1},blur:function(){p.search.cancel(),w.removeClass(m.focus),p.resultsClicked||(p.timer=setTimeout(p.results.hide,f.hideDelay))}},handleKeyboard:function(t){var s,r=w.find(h.result),n=w.find(h.category),i=t.which,a={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},o=m.active,c=r.index(r.filter("."+o)),l=r.size();if(i==a.escape&&(p.verbose("Escape key pressed, blurring search field"),x.trigger("blur")),A.filter(":visible").size()>0)if(i==a.enter){if(p.verbose("Enter key pressed, selecting active result"),r.filter("."+o).size()>0)return e.proxy(p.results.select,r.filter("."+o))(t),t.preventDefault(),!1}else i==a.upArrow?(p.verbose("Up key pressed, changing active result"),s=0>c-1?c:c-1,n.removeClass(o),r.removeClass(o).eq(s).addClass(o).closest(n).addClass(o),t.preventDefault()):i==a.downArrow&&(p.verbose("Down key pressed, changing active result"),s=c+1>=l?c:c+1,n.removeClass(o),r.removeClass(o).eq(s).addClass(o).closest(n).addClass(o),t.preventDefault());else i==a.enter&&(p.verbose("Enter key pressed, executing query"),p.search.query(),C.addClass(m.down),x.one("keyup",function(){C.removeClass(m.down)}))},has:{minimum:function(){var e=x.val(),t=e.length;return t>=f.minCharacters}},search:{cancel:function(){var e=w.data("xhr")||!1;e&&"resolved"!=e.state()&&(p.debug("Cancelling last search"),e.abort())},throttle:function(){clearTimeout(p.timer),p.has.minimum()?p.timer=setTimeout(p.search.query,f.searchDelay):p.results.hide()},query:function(){var t=x.val(),s=p.search.cache.read(t);s?(p.debug("Reading result for '"+t+"' from cache"),p.results.add(s)):(p.debug("Querying for '"+t+"'"),e.isPlainObject(f.source)||e.isArray(f.source)?p.search.local(t):f.apiSettings?p.search.remote(t):e.api!==r&&e.api.settings.api.search!==r?(p.debug("Searching with default search API endpoint"),f.apiSettings={action:"search"},p.search.remote(t)):p.error(g.source),e.proxy(f.onSearchQuery,w)(t))},local:function(t){var s,r=[],n=[],i=e.isArray(f.searchFields)?f.searchFields:[f.searchFields],a=new RegExp("(?:s|^)"+t,"i"),o=new RegExp(t,"i");w.addClass(m.loading),e.each(i,function(t,s){e.each(f.source,function(t,i){var c="string"==typeof i[s],l=-1==e.inArray(i,r)&&-1==e.inArray(i,n);c&&l&&(a.test(i[s])?r.push(i):f.searchFullText&&o.test(i[s])&&n.push(i))})}),s=p.results.generate({results:e.merge(r,n)}),w.removeClass(m.loading),p.search.cache.write(t,s),p.results.add(s)},remote:function(t){var s,r={stateContext:w,urlData:{query:t},onSuccess:function(e){s=p.results.generate(e),p.search.cache.write(t,s),p.results.add(s)},onFailure:p.error};p.search.cancel(),p.debug("Executing search"),e.extend(!0,r,f.apiSettings),e.api(r)},cache:{read:function(e){var t=w.data("cache");return f.cache&&"object"==typeof t&&t[e]!==r?t[e]:!1},write:function(e,t){var s=w.data("cache")!==r?w.data("cache"):{};s[e]=t,w.data("cache",s)}}},results:{generate:function(t){p.debug("Generating html from response",t);var s=f.templates[f.type],r="";return e.isPlainObject(t.results)&&!e.isEmptyObject(t.results)||e.isArray(t.results)&&t.results.length>0?(f.maxResults>0&&(t.results=e.isArray(t.results)?t.results.slice(0,f.maxResults):t.results),e.isFunction(s)?r=s(t):p.error(g.noTemplate,!1)):r=p.message(g.noResults,"empty"),e.proxy(f.onResults,w)(t),r},add:function(t){("default"==f.onResultsAdd||"default"==e.proxy(f.onResultsAdd,A)(t))&&A.html(t),p.results.show()},show:function(){0===A.filter(":visible").size()&&x.filter(":focus").size()>0&&""!==A.html()&&(f.transition&&e.fn.transition!==r&&w.transition("is supported")&&!A.transition("is inward")?(p.debug("Showing results with css animations"),A.transition({animation:f.transition+" in",duration:f.duration,queue:!0})):(p.debug("Showing results with javascript"),A.stop().fadeIn(f.duration,f.easing)),e.proxy(f.onResultsOpen,A)())},hide:function(){A.filter(":visible").size()>0&&(f.transition&&e.fn.transition!==r&&w.transition("is supported")&&!A.transition("is outward")?(p.debug("Hiding results with css animations"),A.transition({animation:f.transition+" out",duration:f.duration,queue:!0})):(p.debug("Hiding results with javascript"),A.stop().fadeIn(f.duration,f.easing)),e.proxy(f.onResultsClose,A)())},select:function(s){p.debug("Search result selected");{var r=e(this),n=r.find(".title");n.html()}if("default"==f.onSelect||"default"==e.proxy(f.onSelect,this)(s)){var i=r.find("a[href]").eq(0),n=r.find(h.title).eq(0),a=i.attr("href")||!1,o=i.attr("target")||!1,c=n.size()>0?n.text():!1;p.results.hide(),c&&x.val(c),a&&("_blank"==o||s.ctrlKey?t.open(a):t.location.href=a)}}},message:function(e,t){return t=t||"standard",p.results.add(f.templates.message(e,t)),f.templates.message(e,t)},setting:function(t,s){if(e.isPlainObject(t))e.extend(!0,f,t);else{if(s===r)return f[t];f[t]=s}},internal:function(t,s){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(s===r)return p[t];p[t]=s}},debug:function(){f.debug&&(f.performance?p.performance.log(arguments):(p.debug=Function.prototype.bind.call(console.info,console,f.name+":"),p.debug.apply(console,arguments)))},verbose:function(){f.verbose&&f.debug&&(f.performance?p.performance.log(arguments):(p.verbose=Function.prototype.bind.call(console.info,console,f.name+":"),p.verbose.apply(console,arguments)))},error:function(){p.error=Function.prototype.bind.call(console.error,console,f.name+":"),p.error.apply(console,arguments)},performance:{log:function(e){var t,s,r;f.performance&&(t=(new Date).getTime(),r=o||t,s=t-r,o=t,c.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:R,"Execution Time":s})),clearTimeout(p.performance.timer),p.performance.timer=setTimeout(p.performance.display,100)},display:function(){var t=f.name+":",s=0;o=!1,clearTimeout(p.performance.timer),e.each(c,function(e,t){s+=t["Execution Time"]}),t+=" "+s+"ms",a&&(t+=" '"+a+"'"),i.size()>1&&(t+=" ("+i.size()+")"),(console.group!==r||console.table!==r)&&c.length>0&&(console.groupCollapsed(t),console.table?console.table(c):e.each(c,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(t,s,i){var a,o,c,l=T;return s=s||d,i=R||i,"string"==typeof t&&l!==r&&(t=t.split(/[\. ]/),a=t.length-1,e.each(t,function(s,n){var i=s!=a?n+t[s+1].charAt(0).toUpperCase()+t[s+1].slice(1):t;if(e.isPlainObject(l[i])&&s!=a)l=l[i];else{if(l[i]!==r)return o=l[i],!1;if(!e.isPlainObject(l[n])||s==a)return l[n]!==r?(o=l[n],!1):!1;l=l[n]}})),e.isFunction(o)?c=o.apply(i,s):o!==r&&(c=o),e.isArray(n)?n.push(c):n!==r?n=[n,c]:c!==r&&(n=c),o}},u?(T===r&&p.initialize(),p.invoke(l)):(T!==r&&p.destroy(),p.initialize())}),n!==r?n:this},e.fn.search.settings={name:"Search Module",namespace:"search",debug:!1,verbose:!0,performance:!0,apiSettings:!1,type:"standard",minCharacters:1,source:!1,searchFields:["title","description"],searchFullText:!0,automatic:"true",hideDelay:0,searchDelay:300,maxResults:7,cache:!0,transition:"scale",duration:300,easing:"easeOutExpo",onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onResults:function(){},onResultsOpen:function(){},onResultsClose:function(){},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},error:{source:"No source or api action specified",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result",title:".title, .name"},templates:{escape:function(e){var t=/[&<>"'`]/g,s=/[&<>"'`]/,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=function(e){return r[e]};return s.test(e)?e.replace(t,n):e},message:function(e,t){var s="";return e!==r&&t!==r&&(s+='<div class="message '+t+'">',s+="empty"==t?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>",s+="</div>"),s},category:function(t){var s="",n=e.fn.search.settings.templates.escape;return t.results!==r?(e.each(t.results,function(t,i){i.results!==r&&i.results.length>0&&(s+='<div class="category"><div class="name">'+i.name+"</div>",e.each(i.results,function(e,t){s+='<div class="result">',t.url&&(s+='<a href="'+t.url+'"></a>'),t.image!==r&&(t.image=n(t.image),s+='<div class="image"> <img src="'+t.image+'" alt=""></div>'),s+='<div class="content">',t.price!==r&&(t.price=n(t.price),s+='<div class="price">'+t.price+"</div>"),t.title!==r&&(t.title=n(t.title),s+='<div class="title">'+t.title+"</div>"),t.description!==r&&(s+='<div class="description">'+t.description+"</div>"),s+="</div></div>"}),s+="</div>")}),t.action&&(s+='<a href="'+t.action.url+'" class="action">'+t.action.text+"</a>"),s):!1},standard:function(t){var s="";return t.results!==r?(e.each(t.results,function(e,t){s+=t.url?'<a class="result" href="'+t.url+'">':'<a class="result">',t.image!==r&&(s+='<div class="image"> <img src="'+t.image+'"></div>'),s+='<div class="content">',t.price!==r&&(s+='<div class="price">'+t.price+"</div>"),t.title!==r&&(s+='<div class="title">'+t.title+"</div>"),t.description!==r&&(s+='<div class="description">'+t.description+"</div>"),s+="</div>",s+="</a>"}),t.action&&(s+='<a href="'+t.action.url+'" class="action">'+t.action.text+"</a>"),s):!1}}}}(jQuery,window,document);